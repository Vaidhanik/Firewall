# Use a lightweight base image with Python
FROM python:3.9-slim

# Install necessary system packages for `netstat`, `arp`, and other utilities
RUN apt-get update && apt-get install -y \
    net-tools \
    iproute2 \
    iputils-ping \
    sudo \
    && rm -rf /var/lib/apt/lists/*

# Create a non-root user and grant sudo privileges
# RUN useradd -m monitor && echo "monitor ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers
RUN useradd -m monitor && echo "monitor:pass" | chpasswd && echo "monitor ALL=(ALL) ALL" >> /etc/sudoers

# Set up the working directory
WORKDIR /app

# Copy the Python script and other necessary files
COPY . /app

# Install Python dependencies (if any)
RUN pip install netifaces

# Fix ownership of the /app directory for the monitor user
RUN chown -R monitor:monitor /app

# Change to the non-root user
USER monitor

# Default command
CMD ["sudo", "python", "monitor.py"]
